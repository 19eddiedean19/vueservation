<template>
  <v-app>
    <v-app-bar color="primary" app dark clipped-right>
      <v-toolbar-title>{{ title }}</v-toolbar-title>
      <v-spacer></v-spacer>
      <v-btn icon @click="setView">
        <v-icon>
          {{
            viewMain === 'calendar'
              ? 'mdi-format-list-bulleted-type'
              : 'mdi-calendar'
          }}
        </v-icon>
      </v-btn>
    </v-app-bar>
    <v-content ref="content">
      <template v-if="isLoaded">
        <sideDrawer></sideDrawer>
        <transition name="component-fade" appear mode="out-in">
          <component :is="viewMain" :key="viewMain"></component>
        </transition>
      </template>
    </v-content>
    <footerApp></footerApp>
    <Snackbar :key="$store.state.snackbarState"></Snackbar>
  </v-app>
</template>

<script>
import btnWithTooltip from '@/components/global/buttons/btnWithTooltip'
import Snackbar from '@/components/global/snackbar'
import footerApp from '@/components/global/footer'

export default {
  name: 'App',
  components: {
    btnWithTooltip,
    calendar: () => import('@/components/calendar/Calendar'),
    catalog: () => import('@/components/catalog/catalog'),
    customFields: () => import('@/components/catalog/customFields'),
    footerApp,
    help: () => import('@/components/help/help'),
    patron: () => import('@/components/patron/patron'),
    settings: () => import('@/views/settings'),
    sideDrawer: () => import('@/components/filterDrawer/FilterDrawer'),
    Snackbar
  },
  data: () => ({
    isLoaded: false,
    title: 'EIPL RESERVATIONS'
  }),
  computed: {
    viewMain: {
      get() {
        return this.$store.state.viewMain
      },
      set(v) {
        this.$store.dispatch('setStateValue', {
          key: 'viewMain',
          value: v
        })
      }
    },
    viewSub: {
      get() {
        return this.$store.state.viewSub
      },
      set(v) {
        this.$store.dispatch('setStateValue', {
          key: 'viewSub',
          value: v
        })
      }
    }
  },
  methods: {
    setDimmensions() {
      // let contentLocal = this.$refs.content.$el.offsetHeight
      let contentState = this.$store.state.content
      contentState.main.x = this.$refs.content.$el.offsetWidth
      contentState.main.y = this.$refs.content.$el.offsetHeight
      this.$store.dispatch('setStateValue', {
        key: 'content',
        value: contentState
      })
      this.isLoaded = true
    },
    setView() {
      this.viewMain = this.viewMain === 'catalog' ? 'calendar' : 'catalog'
      localStorage.setItem('lastView', this.viewMain)
    }
  },
  created() {
    this.viewMain = localStorage.getItem('lastView') || 'calendar'
    this.$store.dispatch('initializeApp', this.$apiSettings)
  },
  mounted() {
    setTimeout(() => {
      this.setDimmensions()
    }, 1500)
  }
}
</script>
<style>
.hoverPointer:hover {
  cursor: pointer;
}

body::-webkit-scrollbar {
  display: none;
}
::-webkit-scrollbar {
  width: 10px;
}

::-webkit-scrollbar-thumb {
  background: #623fa7;
  border-radius: 10px;
}

::-webkit-scrollbar-track {
  background: rgba(102, 102, 102, 0.26);
}

.component-fade-enter-active,
.component-fade-leave-active {
  transition: opacity 0.3s ease;
}
.component-fade-enter, .component-fade-leave-to
/* .component-fade-leave-active below version 2.1.8 */ {
  opacity: 0;
}
</style>
